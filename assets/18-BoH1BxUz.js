import{j as e,r as c}from"./index-D_x0jVGn.js";class n{constructor(i){this.value=i,this.listeners=new Set}getValue(){return this.value}setValue(i){this.value=i,this.listeners.forEach(l=>l())}subscribe(i){return this.listeners.add(i),()=>this.listeners.delete(i)}}const a=new n(0);function t(){const s=c.useSyncExternalStore(i=>a.subscribe(i),()=>a.getValue());return e.jsxs("div",{className:"alert alert-info",children:[e.jsxs("h5",{className:"mb-2",children:[e.jsx("i",{className:"bi bi-123 me-2"}),"計數器值: ",e.jsx("strong",{children:s})]}),e.jsx("p",{className:"mb-0 small",children:"此元件訂閱了外部計數器儲存"})]})}function d(){const s=()=>{a.setValue(a.getValue()+1)},i=()=>{a.setValue(a.getValue()-1)},l=()=>{a.setValue(0)};return e.jsxs("div",{className:"d-flex gap-2 mb-3",children:[e.jsxs("button",{onClick:s,className:"btn btn-success",children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"增加"]}),e.jsxs("button",{onClick:i,className:"btn btn-danger",children:[e.jsx("i",{className:"bi bi-dash-circle me-2"}),"減少"]}),e.jsxs("button",{onClick:l,className:"btn btn-secondary",children:[e.jsx("i",{className:"bi bi-arrow-counterclockwise me-2"}),"重置"]})]})}function m(){return c.useSyncExternalStore(s=>(window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)),()=>window.innerWidth,()=>0)}function h(){const s=m();return e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h3",{className:"card-title mb-3",children:[e.jsx("i",{className:"bi bi-arrows-expand me-2"}),"視窗寬度監聽"]}),e.jsxs("div",{className:"alert alert-success mb-3",children:[e.jsx("h4",{className:"mb-2",children:"當前視窗寬度"}),e.jsxs("div",{className:"display-6 fw-bold text-primary",children:[s," px"]})]}),e.jsxs("p",{className:"text-muted mb-0",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"調整瀏覽器視窗大小查看即時更新"]})]})})}function o(){return c.useSyncExternalStore(s=>(window.addEventListener("online",s),window.addEventListener("offline",s),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",s)}),()=>navigator.onLine,()=>!0)}function x(){const s=o();return e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h3",{className:"card-title mb-3",children:[e.jsx("i",{className:"bi bi-wifi me-2"}),"網路狀態監聽"]}),e.jsx("div",{className:`alert ${s?"alert-success":"alert-danger"}`,children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:`bi ${s?"bi-wifi":"bi-wifi-off"} fs-1 me-3`}),e.jsxs("div",{children:[e.jsx("h5",{className:"mb-1",children:s?"線上":"離線"}),e.jsx("p",{className:"mb-0",children:s?"您目前已連接至網路":"您目前處於離線狀態"})]})]})}),e.jsxs("p",{className:"text-muted small mb-0",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"開啟開發者工具 → Network → 切換 Offline 模式測試"]})]})})}class j{constructor(){this.theme="light",this.listeners=new Set}getTheme(){return this.theme}setTheme(i){this.theme=i,this.listeners.forEach(l=>l())}subscribe(i){return this.listeners.add(i),()=>this.listeners.delete(i)}}const r=new j;function b(){const s=c.useSyncExternalStore(l=>r.subscribe(l),()=>r.getTheme()),i=()=>{r.setTheme(s==="light"?"dark":"light")};return e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h3",{className:"card-title mb-3",children:[e.jsx("i",{className:"bi bi-palette me-2"}),"主題切換"]}),e.jsx("div",{className:`p-4 rounded-3 mb-3 ${s==="light"?"bg-light text-dark":"bg-dark text-white"}`,children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"mb-1",children:[e.jsx("i",{className:`bi ${s==="light"?"bi-sun-fill":"bi-moon-stars-fill"} me-2`}),"當前主題: ",s==="light"?"淺色":"深色"]}),e.jsx("p",{className:"mb-0 small opacity-75",children:"點擊按鈕切換主題"})]}),e.jsxs("button",{onClick:i,className:`btn ${s==="light"?"btn-dark":"btn-light"}`,children:[e.jsx("i",{className:`bi ${s==="light"?"bi-moon-fill":"bi-sun-fill"} me-2`}),"切換"]})]})})]})})}function u(){return e.jsxs("div",{className:"container py-5",children:[e.jsxs("div",{className:"text-center mb-5 p-5 rounded-4 text-white position-relative overflow-hidden",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",boxShadow:"0 10px 40px rgba(102, 126, 234, 0.3)"},children:[e.jsxs("div",{className:"position-relative",style:{zIndex:1},children:[e.jsxs("h1",{className:"display-4 fw-bold mb-3",children:[e.jsx("i",{className:"bi bi-database-fill-gear me-3"}),"useSyncExternalStore Hook"]}),e.jsx("p",{className:"lead mb-0",children:"訂閱外部資料來源並保持同步"})]}),e.jsx("div",{className:"position-absolute top-0 start-0 w-100 h-100",style:{background:"radial-gradient(circle at 20% 50%, rgba(255,255,255,0.1) 0%, transparent 50%)",zIndex:0}})]}),e.jsx("div",{className:"row mb-5",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("h2",{className:"h4 mb-4",children:[e.jsx("i",{className:"bi bi-info-circle me-2 text-primary"}),"Hook 說明"]}),e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle p-3",children:e.jsx("i",{className:"bi bi-check2-circle text-primary fs-4"})})}),e.jsxs("div",{className:"flex-grow-1 ms-3",children:[e.jsx("h5",{className:"mb-2",children:"主要用途"}),e.jsxs("ul",{className:"text-muted mb-0",children:[e.jsx("li",{children:"訂閱瀏覽器 API (視窗大小、線上狀態)"}),e.jsx("li",{children:"整合外部狀態管理函式庫"}),e.jsx("li",{children:"確保並發渲染下的資料一致性"}),e.jsx("li",{children:"訂閱外部資料儲存"})]})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-success bg-opacity-10 rounded-circle p-3",children:e.jsx("i",{className:"bi bi-lightning-charge text-success fs-4"})})}),e.jsxs("div",{className:"flex-grow-1 ms-3",children:[e.jsx("h5",{className:"mb-2",children:"優點"}),e.jsxs("ul",{className:"text-muted mb-0",children:[e.jsx("li",{children:"自動處理訂閱和取消訂閱"}),e.jsx("li",{children:"支援伺服器端渲染"}),e.jsx("li",{children:"確保 tearing 問題不會發生"}),e.jsx("li",{children:"與 React 並發模式相容"})]})]})]})})]})]})})})}),e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h3",{className:"card-title mb-3",children:[e.jsx("i",{className:"bi bi-box-seam me-2"}),"外部計數器儲存"]}),e.jsx("p",{className:"text-muted mb-4",children:"多個元件訂閱同一個外部儲存,所有元件會同步更新"}),e.jsx(d,{}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(t,{})}),e.jsx("div",{className:"col-md-6",children:e.jsx(t,{})})]})]})})})}),e.jsxs("div",{className:"row g-4 mb-4",children:[e.jsx("div",{className:"col-lg-6",children:e.jsx(h,{})}),e.jsx("div",{className:"col-lg-6",children:e.jsx(x,{})})]}),e.jsx("div",{className:"row mb-5",children:e.jsx("div",{className:"col-12",children:e.jsx(b,{})})}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h3",{className:"card-title mb-3",children:[e.jsx("i",{className:"bi bi-code-slash me-2"}),"程式碼範例"]}),e.jsx("pre",{className:"bg-light p-4 rounded-3 overflow-auto",children:e.jsx("code",{children:`import { useSyncExternalStore } from 'react';

// 建立外部儲存
class Store {
  constructor() {
    this.value = 0;
    this.listeners = new Set();
  }
  
  getValue() {
    return this.value;
  }
  
  setValue(newValue) {
    this.value = newValue;
    this.listeners.forEach(listener => listener());
  }
  
  subscribe(listener) {
    this.listeners.add(listener);
    return () => this.listeners.delete(listener);
  }
}

const store = new Store();

// 使用 Hook
function Component() {
  const value = useSyncExternalStore(
    (listener) => store.subscribe(listener),
    () => store.getValue()
  );
  
  return <div>值: {value}</div>;
}

// 訂閱視窗寬度
function useWindowWidth() {
  return useSyncExternalStore(
    (listener) => {
      window.addEventListener('resize', listener);
      return () => window.removeEventListener('resize', listener);
    },
    () => window.innerWidth
  );
}`})})]})})})}),e.jsx("div",{className:"row mt-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm bg-light",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h3",{className:"card-title mb-3",children:[e.jsx("i",{className:"bi bi-lightbulb me-2 text-warning"}),"最佳實踐"]}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"bi bi-check-circle-fill text-success me-2 mt-1"}),e.jsxs("div",{children:[e.jsx("strong",{children:"適用場景:"})," 需要訂閱外部資料來源時使用"]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"bi bi-check-circle-fill text-success me-2 mt-1"}),e.jsxs("div",{children:[e.jsx("strong",{children:"效能:"})," 確保 getSnapshot 函式是純函式"]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"bi bi-check-circle-fill text-success me-2 mt-1"}),e.jsxs("div",{children:[e.jsx("strong",{children:"SSR:"})," 提供 getServerSnapshot 避免水合問題"]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"bi bi-x-circle-fill text-danger me-2 mt-1"}),e.jsxs("div",{children:[e.jsx("strong",{children:"避免:"})," 不要在訂閱函式中產生副作用"]})]})})]})]})})})})]})}export{u as default};
