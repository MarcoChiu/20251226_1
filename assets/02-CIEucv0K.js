import{r as a,j as e,L as A,a as L}from"./index-BEiEE2Na.js";import{M as C}from"./bootstrap.esm-G50tnjl1.js";const D={VITE_APP_Unsplash_AccessKey:"Mjilp2VDqxCTCbkq9e6_1NA_43BXd60uD2T56bNMXV8"},{VITE_APP_Unsplash_AccessKey:T}=D;function q(){const[l,I]=a.useState(""),[t,x]=a.useState(""),[i,b]=a.useState([]),[j,g]=a.useState(1),[n,N]=a.useState(!1),[d,k]=a.useState(null),[r,_]=a.useState(null),f=a.useRef(null),u=a.useRef(null),p=a.useRef(!1),v=a.useRef(0),o=a.useRef(null),P="https://api.unsplash.com/search/photos/",E=T;a.useEffect(()=>{p.current=n},[n]),a.useEffect(()=>{v.current=i.length},[i]);const y=async(s=1,c=!1)=>{if(!(!t.trim()||t.trim().length<3)){if(d!==null&&parseInt(d)<=0){alert("âš ï¸ API è«‹æ±‚æ¬¡æ•¸å·²ç”¨ç›¡ï¼Œè«‹ç¨å¾Œå†è©¦");return}N(!0);try{const m=await L.get(`${P}?query=${t}&client_id=${E}&page=${s}&per_page=12`);console.log("ğŸ“¸ API Response:",m.data);const h=m.headers["x-ratelimit-remaining"];k(h),parseInt(h)<=0&&alert("âš ï¸ API è«‹æ±‚æ¬¡æ•¸å·²ç”¨ç›¡ï¼Œé€™æ˜¯æœ€å¾Œä¸€æ¬¡è«‹æ±‚çš„çµæœ"),b(c?M=>[...M,...m.data.results]:m.data.results)}catch(m){console.error("âŒ Error fetching data from Unsplash API:",m),alert("ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦")}finally{N(!1)}}},R=()=>{l.trim().length>=3&&x(l)};a.useEffect(()=>{t&&(g(1),b([]),y(1,!1))},[t]),a.useEffect(()=>{j>1&&t&&y(j,!0)},[j]),a.useEffect(()=>{const s=new IntersectionObserver(c=>{c[0].isIntersecting&&!p.current&&v.current>0&&(console.log("ğŸ”„ Loading more photos..."),g(h=>h+1))},{threshold:.1});return o.current&&s.observe(o.current),()=>{o.current&&s.unobserve(o.current)}},[]),a.useEffect(()=>{u.current=new C(f.current)},[]);const S=s=>{_(s),u.current.show()},w=()=>{u.current.hide()};return e.jsxs("div",{className:"container py-5",children:[e.jsxs("div",{className:"text-center mb-5 p-5 rounded-4 text-white position-relative overflow-hidden",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",boxShadow:"0 10px 40px rgba(102, 126, 234, 0.3)"},children:[e.jsxs("div",{className:"position-relative",style:{zIndex:1},children:[e.jsxs("h1",{className:"display-4 fw-bold mb-3",children:[e.jsx("i",{className:"bi bi-images me-3"}),"useEffect + useRef + Unsplash API"]}),e.jsx("p",{className:"lead mb-0",children:"API ä¸²éšèˆ‡æ»¾å‹•è¼‰å…¥"})]}),e.jsx("div",{className:"position-absolute top-0 start-0 w-100 h-100",style:{background:"radial-gradient(circle at 20% 50%, rgba(255,255,255,0.1) 0%, transparent 50%)",zIndex:0}})]}),e.jsx("div",{className:"row mb-5",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("h2",{className:"h4 mb-4",children:[e.jsx("i",{className:"bi bi-info-circle me-2 text-primary"}),"åŠŸèƒ½èªªæ˜"]}),e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle p-3",children:e.jsx("i",{className:"bi bi-check2-circle text-primary fs-4"})})}),e.jsxs("div",{className:"flex-grow-1 ms-3",children:[e.jsx("h5",{className:"mb-2",children:"useEffect"}),e.jsxs("ul",{className:"text-muted mb-0",children:[e.jsx("li",{children:"è™•ç†å‰¯ä½œç”¨ï¼ˆAPI å‘¼å«ã€è¨‚é–±ã€DOM æ“ä½œï¼‰"}),e.jsx("li",{children:"ä¾è³´é™£åˆ—æ§åˆ¶åŸ·è¡Œæ™‚æ©Ÿ"}),e.jsx("li",{children:"æ¸…é™¤å‡½å¼é¿å…è¨˜æ†¶é«”æ´©æ¼"})]})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-success bg-opacity-10 rounded-circle p-3",children:e.jsx("i",{className:"bi bi-lightning text-success fs-4"})})}),e.jsxs("div",{className:"flex-grow-1 ms-3",children:[e.jsx("h5",{className:"mb-2",children:"useRef"}),e.jsxs("ul",{className:"text-muted mb-0",children:[e.jsx("li",{children:"ä¿å­˜å¯è®Šå€¼ä¸è§¸ç™¼æ¸²æŸ“"}),e.jsx("li",{children:"å­˜å– DOM å…ƒç´ åƒç…§"}),e.jsx("li",{children:"å„²å­˜ Modalã€Observer å¯¦ä¾‹"})]})]})]})})]})]})})})}),e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h3",{className:"card-title mb-4",children:[e.jsx("i",{className:"bi bi-code-square me-2 text-primary"}),"äº’å‹•ç¯„ä¾‹"]}),e.jsxs("div",{className:"container mt-2",children:[d!==null&&e.jsxs("div",{className:`alert ${parseInt(d)>30?"alert-success":parseInt(d)>10?"alert-warning":"alert-danger"} border-0 shadow-sm mb-4`,children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-speedometer2 me-2"}),e.jsx("strong",{children:"API å‰©é¤˜è«‹æ±‚æ¬¡æ•¸ï¼š"})]}),e.jsxs("span",{className:"badge bg-dark fs-6",children:[d," / 50"]})]}),parseInt(d)<=10&&e.jsxs("small",{className:"d-block mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),"è«‹æ±‚æ¬¡æ•¸å³å°‡ç”¨ç›¡ï¼Œè«‹è¬¹æ…ä½¿ç”¨"]})]}),e.jsx("div",{className:"card mb-4 border-0 shadow-sm",children:e.jsxs("div",{className:"card-body bg-light",children:[e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("label",{className:"form-label small text-muted mb-1",children:[e.jsx("i",{className:"bi bi-search me-1"}),"æœå°‹é—œéµå­—ï¼ˆè‡³å°‘ 3 å€‹å­—å…ƒï¼‰"]}),e.jsx("input",{type:"text",className:"form-control form-control-lg",placeholder:"ä¾‹å¦‚: nature, technology, food, travel...",value:l,onChange:s=>I(s.target.value),onBlur:R,onKeyPress:s=>{s.key==="Enter"&&l.trim().length>=3&&x(l)}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label small text-muted mb-1",children:"Â "}),e.jsxs("button",{className:"btn btn-primary btn-lg w-100",onClick:()=>l.trim().length>=3&&x(l),disabled:l.trim().length<3||n,children:[e.jsx("i",{className:"bi bi-search me-2"}),n?"æœå°‹ä¸­...":"æœå°‹åœ–ç‰‡"]})]})]}),l.trim().length>0&&l.trim().length<3&&e.jsxs("small",{className:"text-danger d-block mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-circle me-1"}),"è«‹è¼¸å…¥è‡³å°‘ 3 å€‹å­—å…ƒ"]})]})}),t&&i.length>0&&e.jsxs("div",{className:"alert alert-info border-0 shadow-sm mb-4",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"æœå°‹ã€Œ",e.jsx("strong",{children:t}),"ã€æ‰¾åˆ° ",e.jsx("strong",{children:i.length})," å¼µåœ–ç‰‡",e.jsx("span",{className:"text-muted ms-2 small",children:"(æ»¾å‹•åˆ°åº•éƒ¨è‡ªå‹•è¼‰å…¥æ›´å¤š)"})]}),e.jsx("div",{className:"row g-4",children:i.map(s=>e.jsx("div",{className:"col-lg-3 col-md-4 col-sm-6",children:e.jsxs("div",{className:"card h-100 border-0 shadow-sm",style:{transition:"all 0.3s ease",cursor:"pointer"},onClick:()=>S(s),onMouseEnter:c=>{c.currentTarget.style.transform="translateY(-8px)",c.currentTarget.style.boxShadow="0 8px 16px rgba(0,0,0,0.2)"},onMouseLeave:c=>{c.currentTarget.style.transform="translateY(0)",c.currentTarget.style.boxShadow=""},children:[e.jsx("img",{src:s.urls.small,alt:s.alt_description||"Unsplash photo",className:"card-img-top",style:{height:"200px",objectFit:"cover"},loading:"lazy"}),e.jsxs("div",{className:"card-body p-3",children:[e.jsx("p",{className:"card-text small text-muted mb-2 text-truncate",title:s.alt_description,children:s.alt_description||"ç„¡æè¿°"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-heart-fill text-danger me-1"}),s.likes.toLocaleString()]}),e.jsxs("small",{className:"text-muted text-truncate",style:{maxWidth:"120px"},children:[e.jsx("i",{className:"bi bi-person-circle me-1"}),s.user.name]})]})]})]})},s.id))}),i.length===0&&!n&&t&&e.jsxs("div",{className:"text-center text-muted mt-5 py-5",children:[e.jsx("i",{className:"bi bi-search display-1 mb-3 d-block"}),e.jsx("p",{className:"fs-5",children:"æ²’æœ‰æ‰¾åˆ°ç›¸é—œåœ–ç‰‡"}),e.jsx("p",{className:"small",children:"è«‹å˜—è©¦å…¶ä»–é—œéµå­—ï¼Œä¾‹å¦‚: nature, technology, food, travel"})]}),i.length===0&&!n&&!t&&e.jsxs("div",{className:"text-center text-muted mt-5 py-5",children:[e.jsx("i",{className:"bi bi-images display-1 mb-3 d-block"}),e.jsx("p",{className:"fs-5",children:"é–‹å§‹æœå°‹ç¾éº—çš„åœ–ç‰‡"}),e.jsx("p",{className:"small",children:"è¼¸å…¥é—œéµå­—ä¸¦é»æ“Šæœå°‹æŒ‰éˆ•"})]}),e.jsx("div",{ref:o,style:{height:"20px",margin:"20px 0"}}),n&&e.jsx(A,{children:e.jsx("b",{children:"è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™..."})})]})]})})})}),e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h3",{className:"card-title mb-4",children:[e.jsx("i",{className:"bi bi-code-slash me-2 text-success"}),"ç¨‹å¼ç¢¼ç¯„ä¾‹"]}),e.jsx("div",{className:"container mt-2",children:e.jsx("div",{className:"card bg-dark text-white shadow mt-3",children:e.jsx("div",{className:"card-body",children:e.jsx("pre",{className:"mb-0",style:{fontSize:"0.85rem"},children:`// 1ï¸âƒ£ useEffect ç›£è½æœå°‹è³‡æ–™æ”¹è®Š
useEffect(() => {
  if (searchData) {
    setPage(1);
    setPhotos([]);
    getPhoto(1, false);
  }
}, [searchData]);

// 2ï¸âƒ£ useRef ä¿å­˜ Modal å¯¦ä¾‹
const photoModal = useRef(null);
useEffect(() => {
  photoModal.current = new Modal(modalRef.current);
}, []);

// 3ï¸âƒ£ IntersectionObserver ç„¡é™æ»¾å‹•
useEffect(() => {
  const observer = new IntersectionObserver((entries) => {
    if (entries[0].isIntersecting && !isLoading) {
      setPage(prev => prev + 1);
    }
  });
  
  if (loadingSentinelRef.current) {
    observer.observe(loadingSentinelRef.current);
  }
  
  return () => observer.disconnect();
}, []);`})})})})]})})})}),e.jsx("div",{className:"modal fade",ref:f,"aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered modal-xl",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header bg-dark text-white",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-image me-2"}),r?.alt_description||"åœ–ç‰‡é è¦½"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:w,"aria-label":"Close"})]}),e.jsx("div",{className:"modal-body text-center bg-dark",children:r&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:r.urls.regular,alt:r.alt_description||"Unsplash photo",className:"img-fluid rounded mb-3",style:{maxHeight:"70vh",objectFit:"contain"}}),e.jsx("div",{className:"text-start bg-light p-3 rounded",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("p",{className:"mb-1 small text-muted",children:"æ”å½±å¸«"}),e.jsxs("p",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-person-circle me-1"}),e.jsx("strong",{children:r.user.name})]})]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("p",{className:"mb-1 small text-muted",children:"å–œæ­¡æ•¸"}),e.jsxs("p",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-heart-fill text-danger me-1"}),e.jsx("strong",{children:r.likes.toLocaleString()})]})]}),r.description&&e.jsxs("div",{className:"col-12 mt-2",children:[e.jsx("p",{className:"mb-1 small text-muted",children:"æè¿°"}),e.jsx("p",{className:"mb-0",children:r.description})]})]})})]})}),e.jsxs("div",{className:"modal-footer",children:[r&&e.jsxs("a",{href:r.links.html,target:"_blank",rel:"noopener noreferrer",className:"btn btn-primary",children:[e.jsx("i",{className:"bi bi-box-arrow-up-right me-1"}),"åœ¨ Unsplash æŸ¥çœ‹"]}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:w,children:"é—œé–‰"})]})]})})})]})}export{q as default};
